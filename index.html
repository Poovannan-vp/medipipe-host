<!DOCTYPE html>
<html>
  <head>
    <title>Medicine Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
      video, canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <video id="input_video" autoplay playsinline></video>
    <canvas id="output_canvas"></canvas>

    <script>
      const videoElement = document.getElementById('input_video');
      const canvasElement = document.getElementById('output_canvas');
      const canvasCtx = canvasElement.getContext('2d');

      const holistic = new Holistic({
        locateFile: (file) =>
          `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`,
      });

      holistic.setOptions({
        modelComplexity: 1,
        smoothLandmarks: true,
        enableSegmentation: false,
        refineFaceLandmarks: true,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5,
      });

      let handNearMouthCounter = 0;

      function getDistance(p1, p2) {
        return Math.sqrt(
          Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)
        );
      }

      holistic.onResults((results) => {
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(
          results.image,
          0,
          0,
          canvasElement.width,
          canvasElement.height
        );
        canvasCtx.restore();

       if (
  results.rightHandLandmarks &&
  results.faceLandmarks &&
  results.faceLandmarks[13] // approximate mouth
) {
  const handTip = results.rightHandLandmarks[8]; // index fingertip
  const mouthCenter = results.faceLandmarks[13]; // upper lip area

  const dist = getDistance(handTip, mouthCenter);
  console.log('Distance:', dist);

  if (dist < 0.1) {
    console.log('Medicine detected!');
    window.ReactNativeWebView?.postMessage('medicine_taken');
  }
}

      });

      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await holistic.send({ image: videoElement });
        },
        width: 640,
        height: 480,
      });
      camera.start();
    </script>
  </body>
</html>
